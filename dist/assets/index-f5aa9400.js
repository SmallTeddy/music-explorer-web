import{t as U,T as V}from"./index-a24bf647.js";import{e as j,f as l,k as b,g as O,r as Y,c as C,d as n,j as R,a as G,w as J,F as K,l as Q,m as X,o as S,n as Z,t as A,p as ee,b as te,_ as ae}from"./index-ebd542a1.js";const ne="/assets/十一月的肖邦-5bd2859e.png";function se(){return U.get({url:`${V}/music`})}const le="/assets/夜曲-e1816606.mp3",F=m=>(ee("data-v-c2abc62d"),m=m(),te(),m),oe={class:"music-container flex flex-column flex-align"},ce={class:"audio-container flex-align"},ie=F(()=>n("img",{src:ne,alt:"十一月的肖邦",style:{width:"5.2rem"}},null,-1)),ue=F(()=>n("div",{class:"flex-column",style:{"margin-left":"0.5rem"}},[n("div",{style:{"font-size":"1.6rem",color:"#999","margin-bottom":"0.2rem"}},"夜曲"),n("div",{style:{"font-size":"1.2rem",color:"#999"}},"周杰伦 - 夜曲")],-1)),re={class:"mp3Box"},ve=["src"],de={style:{width:"60px","text-align":"center"}},fe={ref:"containerRef",class:"lrc-container"},me={ref:"ulRef",class:"lrc-list"},_e={class:"cvs-container"},he={ref:"canvasRef"},pe=j({__name:"index",setup(m){const{proxy:_}=X(),k=l(),r=l([]),f=l(null),v=l(null),T=l(null),d=l(null),s=l(null),h=l(!1),o=l(null),c=l(null),p=l("Wavy"),H=()=>{se().then(async e=>{const{data:t}=await e;k.value=t,I()})},I=()=>{const e=k.value.split(`
`);r.value=[],e.map(t=>{const a=t.split("]"),i=a[0].substring(1),u={time:W(i),words:a[1]};r.value.push(u)})},W=e=>{const t=e.split(":");return+t[0]*60+ +t[1]},L=b(()=>{var e;return(e=T.value)==null?void 0:e.clientHeight}),B=b(()=>{var e;return(e=v.value.children[0])==null?void 0:e.clientHeight}),D=b(()=>{var e;return((e=v.value)==null?void 0:e.clientHeight)-L.value}),$=()=>{const e=f.value.currentTime;for(let t=0;t<r.value.length;t++)if(e<r.value[t].time)return t-1;return r.value.length-1},z=()=>{const e=$();let t=B.value*e+B.value/2-L.value/2;t=t<0?0:t,t=t>D.value?D.value:t,v.value.style.transform=`translateY(-${t}px)`;let a=v.value.querySelector(".active");a&&a.classList.remove("active"),a=v.value.children[e],a&&a.classList.add("active")},N=()=>{d.value.width=window.innerWidth*devicePixelRatio,d.value.height=300},M=()=>{f.value.onplay=()=>{if(h.value)return;const e=new AudioContext,t=e.createMediaElementSource(f.value);o.value=e.createAnalyser(),o.value.fftSize=512,c.value=new Uint8Array(o.value.frequencyBinCount),t.connect(o.value),o.value.connect(e.destination),h.value=!0}},q=()=>{requestAnimationFrame(q);const{width:e,height:t}=d.value;if(s.value.clearRect(0,0,e,t),!!h.value&&c.value){o.value&&o.value.getByteFrequencyData(c.value);const a=c.value.length,i=e/a;s.value.fillStyle="skyblue",c.value.forEach((u,w)=>{const g=u/255*t,E=w*i,y=t-g;s.value.fillRect(E,y,i,g)})}},x=()=>{requestAnimationFrame(x);const{width:e,height:t}=d.value;if(s.value.clearRect(0,0,e,t),!!h.value&&c.value){o.value&&o.value.getByteFrequencyData(c.value);const a=c.value.length,i=e*1/a;let u=0;s.value.beginPath(),s.value.strokeStyle="skyblue",c.value.forEach((w,g)=>{const y=w/255*t/2;g===0?s.value.moveTo(u,y):s.value.lineTo(u,y),u+=i}),s.value.lineTo(e,t/2),s.value.stroke()}},P=()=>{p.value=p.value==="Columnar"?"Wavy":"Columnar",p.value=="Columnar"?q():x()};return O(()=>{H(),f.value=_.$refs.audioRef,v.value=_.$refs.ulRef,T.value=_.$refs.containerRef,d.value=_.$refs.canvasRef,s.value=d.value.getContext("2d"),M(),N(),x(),f.value.addEventListener("timeupdate",z)}),(e,t)=>{const a=Y("el-button");return S(),C("div",oe,[n("div",ce,[ie,ue,n("div",re,[n("audio",{ref:"audioRef",controls:"",src:R(le)},null,8,ve)]),n("div",de,[G(a,{link:"",onClick:P},{default:J(()=>[Z(A(R(p)),1)]),_:1})])]),n("div",fe,[n("ul",me,[(S(!0),C(K,null,Q(R(r),i=>(S(),C("li",{key:i.time},A(i.words),1))),128))],512)],512),n("div",_e,[n("canvas",he,null,512)])])}}});const xe=ae(pe,[["__scopeId","data-v-c2abc62d"]]);export{xe as default};
